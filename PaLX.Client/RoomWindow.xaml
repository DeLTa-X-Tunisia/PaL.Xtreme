<Window x:Class="PaLX.Client.RoomWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:PaLX.Client.Converters"
        xmlns:controls="clr-namespace:PaLX.Client.Controls"
        mc:Ignorable="d"
        Title="Salon de Discussion" Height="750" Width="1100"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:UrlToImageSourceConverter x:Key="UrlToImageSourceConverter"/>
        
        <!-- Color Palette -->
        <SolidColorBrush x:Key="PrimaryRed" Color="#E03E2F"/>
        <SolidColorBrush x:Key="PrimaryRedDark" Color="#8B2920"/>
        <SolidColorBrush x:Key="AccentRed" Color="#FF6B5B"/>
        <SolidColorBrush x:Key="BackgroundLight" Color="#F8F9FA"/>
        <SolidColorBrush x:Key="CardBackground" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BorderLight" Color="#E8E8E8"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#1A1A2E"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#6B7280"/>
        <SolidColorBrush x:Key="OnlineGreen" Color="#4CAF50"/>
        <SolidColorBrush x:Key="WarningYellow" Color="#F1C40F"/>
        
        <!-- Role Colors -->
        <SolidColorBrush x:Key="RoleOwner" Color="#FF0000"/>
        <SolidColorBrush x:Key="RoleSuperAdmin" Color="#FF4500"/>
        <SolidColorBrush x:Key="RoleAdmin" Color="#FFA500"/>
        <SolidColorBrush x:Key="RolePowerUser" Color="#008000"/>
        <SolidColorBrush x:Key="RoleModerator" Color="#0000FF"/>
        <SolidColorBrush x:Key="RoleMember" Color="#374151"/>
        
        <!-- Icon Button Style -->
        <Style x:Key="IconButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="12">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F0F0F0"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E0E0E0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Header Button Style -->
        <Style x:Key="HeaderButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#20FFFFFF"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="12">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#40FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Control Toggle Button Style -->
        <Style x:Key="ControlToggleStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="52"/>
            <Setter Property="Height" Value="52"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border" CornerRadius="26" Background="#F0F0F0">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.1" Color="Black"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryRed}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="12" ShadowDepth="3" Opacity="0.2" Color="Black"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Status Icon Style -->
        <Style x:Key="StatusIconStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <!-- Send Button Style -->
        <Style x:Key="SendButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="16" Background="{StaticResource PrimaryRed}">
                            <Border.Effect>
                                <DropShadowEffect Color="#E03E2F" BlurRadius="12" ShadowDepth="0" Opacity="0.3"/>
                            </Border.Effect>
                            <TextBlock Text="&#xE724;" FontFamily="Segoe MDL2 Assets" FontSize="18" 
                                       Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource AccentRed}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryRedDark}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- Main Container with Shadow -->
    <Border CornerRadius="20" Margin="10">
        <Border.Background>
            <SolidColorBrush Color="#FAFAFA"/>
        </Border.Background>
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.2" Color="Black"/>
        </Border.Effect>
        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>      <!-- Chat Area -->
                <ColumnDefinition Width="320"/>    <!-- Members Sidebar -->
            </Grid.ColumnDefinitions>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- LEFT: CHAT AREA                                                   -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- Header -->
                    <RowDefinition Height="Auto"/>  <!-- Video Zone -->
                    <RowDefinition Height="*"/>     <!-- Messages -->
                    <RowDefinition Height="Auto"/>  <!-- Input -->
                </Grid.RowDefinitions>

                <!-- HEADER -->
                <Border Grid.Row="0" CornerRadius="20,0,0,0" Padding="20,14" MouseLeftButtonDown="Header_MouseDown">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#E03E2F" Offset="0"/>
                            <GradientStop Color="#8B2920" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Room Info -->
                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <!-- Room Icon -->
                                <Border Width="42" Height="42" CornerRadius="12" Background="#30FFFFFF" Margin="0,0,12,0">
                                    <TextBlock Text="ðŸ’¬" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                
                                <StackPanel VerticalAlignment="Center">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock x:Name="RoomNameText" Text="Nom du Salon" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                        <Border x:Name="CategoryBadge" Background="#40FFFFFF" CornerRadius="8" Padding="10,3" Margin="12,0,0,0" VerticalAlignment="Center">
                                            <TextBlock x:Name="CategoryText" Text="GÃ©nÃ©ral" FontSize="11" Foreground="White" FontWeight="SemiBold"/>
                                        </Border>
                                        <Border x:Name="AdultBadge" Background="#E74C3C" CornerRadius="8" Padding="8,3" Margin="8,0,0,0" VerticalAlignment="Center" Visibility="Collapsed">
                                            <TextBlock Text="18+" FontSize="10" Foreground="White" FontWeight="Bold"/>
                                        </Border>
                                        <Border x:Name="InvisibleModeBadge" Background="#AB47BC" CornerRadius="8" Padding="8,3" Margin="8,0,0,0" VerticalAlignment="Center" Visibility="Collapsed">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="ðŸ‘»" FontSize="10" Margin="0,0,4,0"/>
                                                <TextBlock Text="INVISIBLE" FontSize="9" Foreground="White" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                        <TextBlock Text="ðŸ‘‘ " FontSize="11"/>
                                        <TextBlock x:Name="OwnerNameText" Text="Admin" FontSize="12" Foreground="#D0FFFFFF" FontWeight="SemiBold"/>
                                        <TextBlock Text="  â€¢  " FontSize="12" Foreground="#80FFFFFF"/>
                                        <TextBlock Text="â±ï¸ " FontSize="11"/>
                                        <TextBlock x:Name="UptimeText" Text="00:00" FontSize="12" Foreground="#D0FFFFFF"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Header Actions -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                            <!-- Stats Pills -->
                            <Border Background="#30FFFFFF" CornerRadius="12" Padding="12,6" Margin="0,0,12,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ‘¥ " FontSize="13"/>
                                    <TextBlock x:Name="TotalCountText" Text="0" FontSize="13" Foreground="White" FontWeight="Bold"/>
                                    <TextBlock Text="  |  " Foreground="#60FFFFFF" FontSize="13"/>
                                    <TextBlock Text="ðŸ‘¨ " FontSize="13"/>
                                    <TextBlock x:Name="MenCountText" Text="0" FontSize="13" Foreground="White"/>
                                    <TextBlock Text="  " FontSize="13"/>
                                    <TextBlock Text="ðŸ‘© " FontSize="13"/>
                                    <TextBlock x:Name="WomenCountText" Text="0" FontSize="13" Foreground="White"/>
                                </StackPanel>
                            </Border>
                            
                            <Rectangle Width="1" Height="28" Fill="#40FFFFFF" Margin="0,0,12,0"/>
                            
                            <!-- Window Controls -->
                            <Button Click="Minimize_Click" Style="{StaticResource HeaderButtonStyle}" Width="36" Height="32" ToolTip="RÃ©duire">
                                <TextBlock Text="&#xE921;" FontFamily="Segoe MDL2 Assets" FontSize="10" Foreground="White"/>
                            </Button>
                            <Button x:Name="MaximizeButton" Click="Maximize_Click" Style="{StaticResource HeaderButtonStyle}" Width="36" Height="32" ToolTip="Agrandir">
                                <TextBlock x:Name="MaximizeIcon" Text="&#xE922;" FontFamily="Segoe MDL2 Assets" FontSize="10" Foreground="White"/>
                            </Button>
                            <Button Click="Leave_Click" ToolTip="Quitter le salon" Width="36" Height="32" Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg" Background="Transparent" CornerRadius="0,16,0,0">
                                            <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="10" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="bg" Property="Background" Value="#E81123"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- MESSAGES AREA -->
                <Border Grid.Row="2" Background="{StaticResource BackgroundLight}">
                    <ListView x:Name="MessagesList" BorderThickness="0" Background="Transparent" 
                              Margin="16,10" ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                              ScrollViewer.CanContentScroll="False">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0,4"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListViewItem">
                                            <ContentPresenter/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <!-- Normal Message Bubble -->
                                    <Border Visibility="{Binding BubbleVisibility}" Background="White" CornerRadius="16" Padding="14,10" Margin="0,2">
                                        <Border.Effect>
                                            <DropShadowEffect BlurRadius="8" ShadowDepth="1" Opacity="0.08" Color="Black"/>
                                        </Border.Effect>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Avatar with Role Color Border -->
                                            <Border Width="42" Height="42" CornerRadius="21" Margin="0,0,12,0" VerticalAlignment="Top"
                                                    BorderThickness="2.5" BorderBrush="{Binding RoleColor}">
                                                <Border CornerRadius="19">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#F0F0F0"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding AvatarPath, Converter={StaticResource UrlToImageSourceConverter}}" Value="{x:Null}">
                                                                    <Setter Property="Background" Value="#F0F0F0"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <Grid>
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource UrlToImageSourceConverter}}" Stretch="UniformToFill"/>
                                                        <TextBlock Text="ðŸ‘¤" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="18">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding AvatarPath}" Value="">
                                                                            <Setter Property="Visibility" Value="Visible"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding AvatarPath}" Value="{x:Null}">
                                                                            <Setter Property="Visibility" Value="Visible"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </Grid>
                                                </Border>
                                            </Border>

                                            <StackPanel Grid.Column="1">
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                                    <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="13.5" 
                                                               Foreground="{Binding RoleColor}"/>
                                                    <Border Background="{Binding RoleColor}" CornerRadius="4" Padding="6,1" Margin="8,0,0,0" 
                                                            VerticalAlignment="Center" Opacity="0.15">
                                                        <TextBlock Text="{Binding RoleName}" FontSize="9" Foreground="{Binding RoleColor}" FontWeight="Bold"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Timestamp, StringFormat=HH:mm}" FontSize="11" Foreground="#9CA3AF" 
                                                               Margin="10,0,0,0" VerticalAlignment="Center"/>
                                                </StackPanel>
                                                <TextBlock Text="{Binding Content}" TextWrapping="Wrap" FontSize="14" Foreground="#374151" LineHeight="20"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- System Message -->
                                    <Border Visibility="{Binding SystemVisibility}" HorizontalAlignment="Center" Margin="0,8">
                                        <Border Background="#E5E7EB" CornerRadius="12" Padding="16,8">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="â„¹ï¸ " FontSize="12"/>
                                                <TextBlock Text="{Binding Content}" FontSize="12" Foreground="#6B7280" FontStyle="Italic"/>
                                            </StackPanel>
                                        </Border>
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>

                <!-- INPUT AREA -->
                <Border Grid.Row="3" Background="White" Padding="16,12" CornerRadius="0,0,0,20">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="-2" Opacity="0.05" Color="Black" Direction="90"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>  <!-- Attachment -->
                            <ColumnDefinition Width="*"/>     <!-- Input -->
                            <ColumnDefinition Width="Auto"/>  <!-- Emoji -->
                            <ColumnDefinition Width="Auto"/>  <!-- Send -->
                        </Grid.ColumnDefinitions>

                        <!-- Attachment Button -->
                        <Button Grid.Column="0" Style="{StaticResource IconButtonStyle}" Margin="0,0,8,0" ToolTip="Joindre un fichier">
                            <TextBlock Text="&#xE723;" FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="#6B7280"/>
                        </Button>

                        <!-- Text Input -->
                        <Border Grid.Column="1" Background="#F3F4F6" CornerRadius="16" Padding="4,0">
                            <TextBox x:Name="MessageInput" BorderThickness="0" Background="Transparent" 
                                     FontSize="14" Padding="12,10" VerticalContentAlignment="Center"
                                     KeyDown="MessageInput_KeyDown">
                                <TextBox.Style>
                                    <Style TargetType="TextBox">
                                        <Setter Property="Foreground" Value="#1F2937"/>
                                    </Style>
                                </TextBox.Style>
                            </TextBox>
                        </Border>

                        <!-- Emoji Button -->
                        <Button Grid.Column="2" Style="{StaticResource IconButtonStyle}" Margin="8,0" ToolTip="Emoji">
                            <TextBlock Text="ðŸ˜Š" FontSize="20"/>
                        </Button>

                        <!-- Send Button -->
                        <Button Grid.Column="3" x:Name="SendButton" Click="Send_Click" Style="{StaticResource SendButtonStyle}"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <!-- RIGHT: MEMBERS SIDEBAR                                            -->
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <Border Grid.Column="1" Background="White" CornerRadius="0,20,20,0">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="15" ShadowDepth="-3" Opacity="0.08" Color="Black" Direction="180"/>
                </Border.Effect>
                
                <Grid Margin="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>  <!-- Title -->
                        <RowDefinition Height="*"/>     <!-- Members List -->
                        <RowDefinition Height="Auto"/>  <!-- My Controls -->
                    </Grid.RowDefinitions>

                    <!-- Section Title -->
                    <Border Grid.Row="0" Padding="20,16" BorderBrush="#F0F0F0" BorderThickness="0,0,0,1">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ‘¥" FontSize="16" Margin="0,0,8,0"/>
                            <TextBlock Text="Membres" FontWeight="Bold" FontSize="15" Foreground="{StaticResource TextPrimary}"/>
                            <Border Background="#F0F0F0" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                <TextBlock x:Name="MemberCountBadge" Text="0" FontSize="12" Foreground="#6B7280" FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Members List -->
                    <ListView Grid.Row="1" x:Name="MembersList" BorderThickness="0" Background="Transparent" 
                              Margin="8,8" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0,2"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListViewItem">
                                            <Border x:Name="border" Background="Transparent" CornerRadius="12" Padding="10,8">
                                                <ContentPresenter/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#F8F9FA"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Avatar with Role Color -->
                                    <Grid Grid.Column="0" Margin="0,0,10,0">
                                        <Border Width="40" Height="40" CornerRadius="20" BorderThickness="2.5" BorderBrush="{Binding RoleColor}">
                                            <Border CornerRadius="18">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="#F0F0F0"/>
                                                    </Style>
                                                </Border.Style>
                                                <Grid>
                                                    <Image Source="{Binding AvatarPath, Converter={StaticResource UrlToImageSourceConverter}}" Stretch="UniformToFill">
                                                        <Image.Clip>
                                                            <EllipseGeometry Center="18,18" RadiusX="18" RadiusY="18"/>
                                                        </Image.Clip>
                                                    </Image>
                                                    <TextBlock Text="ðŸ‘¤" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding AvatarPath}" Value="">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding AvatarPath}" Value="{x:Null}">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Grid>
                                            </Border>
                                        </Border>
                                        <!-- Mic Active Indicator -->
                                        <Border Width="14" Height="14" CornerRadius="7" Background="{StaticResource OnlineGreen}" 
                                                HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,-2,-2"
                                                BorderBrush="White" BorderThickness="2"
                                                Visibility="{Binding IsMicOn, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Border.Effect>
                                                <DropShadowEffect BlurRadius="4" ShadowDepth="0" Opacity="0.3" Color="#4CAF50"/>
                                            </Border.Effect>
                                        </Border>
                                    </Grid>

                                    <!-- Name & Role -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding InvisibleIndicator}" FontSize="13" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="13" Foreground="{StaticResource TextPrimary}"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                            <Border Width="8" Height="8" CornerRadius="4" Background="{Binding RoleColor}" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding RoleName}" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Status Icons -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                        <!-- Speaking Timer -->
                                        <Border Visibility="{Binding IsMicOn, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                Background="#FEE2E2" CornerRadius="8" Padding="6,2" Margin="0,0,4,0">
                                            <TextBlock Text="{Binding SpeakingTime}" Foreground="#DC2626" FontSize="10" FontWeight="Bold"/>
                                        </Border>

                                        <!-- Hand Raised -->
                                        <Border Background="{StaticResource WarningYellow}" CornerRadius="10" Padding="5,3" Margin="2,0" 
                                                Visibility="{Binding HasHandRaised, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock Text="âœ‹" FontSize="11"/>
                                        </Border>
                                        
                                        <!-- Mic Icon -->
                                        <TextBlock Text="&#xE720;" FontFamily="Segoe MDL2 Assets" FontSize="14" Margin="4,0"
                                                   Visibility="{Binding IsMicOn, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="{StaticResource OnlineGreen}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsMicOn}" Value="True">
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard Name="PulseAnim">
                                                                    <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="1.0" To="0.5" Duration="0:0:0.6"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                            <DataTrigger.ExitActions>
                                                                <StopStoryboard BeginStoryboardName="PulseAnim"/>
                                                            </DataTrigger.ExitActions>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <!-- Cam Icon - Bouton cliquable pour voir la vidÃ©o -->
                                        <Button Click="ViewPeerCamera_Click" 
                                                Visibility="{Binding IsCamOn, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                Tag="{Binding}"
                                                Cursor="Hand" ToolTip="Voir la vidÃ©o"
                                                Background="Transparent" BorderThickness="0" Padding="0" Margin="4,0">
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="camBorder" Background="Transparent" CornerRadius="4" Padding="4,2">
                                                        <TextBlock Text="&#xE714;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="{StaticResource PrimaryRed}"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="camBorder" Property="Background" Value="#FFEBEE"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>
                                    </StackPanel>

                                    <!-- Context Menu -->
                                    <Grid.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="ðŸ‘¤  Voir le profil"/>
                                            <Separator/>
                                            <MenuItem Header="ðŸŽ¤  Autoriser la parole" Click="AllowSpeak_Click" Visibility="{Binding CanModerate, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            <MenuItem Header="ðŸ”‡  Couper le micro" Click="MuteMic_Click" Visibility="{Binding CanModerate, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            <MenuItem Header="ðŸ“¹  Couper la camÃ©ra" Click="MuteCam_Click" Visibility="{Binding CanModerate, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            <Separator Visibility="{Binding CanModerate, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            <MenuItem Header="âš ï¸  Expulser" Click="Kick_Click" Foreground="#DC2626" Visibility="{Binding CanModerate, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            <MenuItem Header="ðŸš«  Bannir" Click="Ban_Click" Foreground="#DC2626" Visibility="{Binding CanModerate, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </ContextMenu>
                                    </Grid.ContextMenu>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- MY CONTROLS -->
                    <Border Grid.Row="2" Background="#FAFAFA" Padding="16" Margin="12,0,12,12" CornerRadius="16">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.08" Color="Black"/>
                        </Border.Effect>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Speaking Timer Panel -->
                            <Border x:Name="SpeakingTimerPanel" Grid.Row="0" Background="{StaticResource PrimaryRed}" CornerRadius="10" 
                                    Padding="12,8" Margin="0,0,0,12" Visibility="Collapsed">
                                <Border.Effect>
                                    <DropShadowEffect Color="#E03E2F" BlurRadius="10" ShadowDepth="0" Opacity="0.3"/>
                                </Border.Effect>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸŽ™ï¸" FontSize="14" Margin="0,0,8,0"/>
                                    <TextBlock Text="Temps de parole : " Foreground="White" FontWeight="SemiBold" FontSize="13"/>
                                    <TextBlock x:Name="TimerText" Text="00:00" Foreground="White" FontWeight="Bold" FontSize="13"/>
                                </StackPanel>
                            </Border>

                            <!-- Control Buttons -->
                            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                <!-- Microphone Toggle -->
                                <ToggleButton x:Name="MicToggle" Style="{StaticResource ControlToggleStyle}" Margin="6" Click="ToggleMic_Click" ToolTip="Microphone">
                                    <TextBlock x:Name="MicIcon" Text="&#xE720;" FontFamily="Segoe MDL2 Assets" FontSize="20" Foreground="#6B7280"/>
                                </ToggleButton>

                                <!-- Camera Toggle -->
                                <ToggleButton x:Name="CamToggle" Style="{StaticResource ControlToggleStyle}" Margin="6" Click="ToggleCam_Click" ToolTip="CamÃ©ra">
                                    <TextBlock x:Name="CamIcon" Text="&#xE714;" FontFamily="Segoe MDL2 Assets" FontSize="20" Foreground="#6B7280"/>
                                </ToggleButton>

                                <!-- Hand Toggle -->
                                <ToggleButton x:Name="HandToggle" Margin="6" Click="ToggleHand_Click" ToolTip="Lever la main" Width="52" Height="52" Cursor="Hand">
                                    <ToggleButton.Template>
                                        <ControlTemplate TargetType="ToggleButton">
                                            <Border x:Name="border" CornerRadius="26" Background="#F0F0F0">
                                                <Border.Effect>
                                                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.1" Color="Black"/>
                                                </Border.Effect>
                                                <TextBlock Text="âœ‹" FontSize="22" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsChecked" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{StaticResource WarningYellow}"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect BlurRadius="12" ShadowDepth="3" Opacity="0.2" Color="Black"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </ToggleButton.Template>
                                </ToggleButton>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
